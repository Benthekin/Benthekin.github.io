<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Minecraft-like Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }

    /* UI Styles */
    #joystick-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 100px;
      height: 100px;
      background: rgba(200, 200, 200, 0.5);
      border-radius: 50%;
      touch-action: none;
    }
    #inventory {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 5px;
    }
    .inventory-item {
      width: 50px;
      height: 50px;
      background-color: lightgray;
      border: 2px solid black;
      cursor: pointer;
    }
    #jump-button {
      position: fixed;
      bottom: 100px;
      left: 60px;
      width: 80px;
      height: 80px;
      background-color: orange;
      border-radius: 50%;
      text-align: center;
      line-height: 80px;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="joystick-container"></div>
  <div id="jump-button">Jump</div>
  <div id="inventory"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Basic Three.js setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting setup
    const ambientLight = new THREE.AmbientLight(0x404040);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 7.5).normalize();
    scene.add(ambientLight);
    scene.add(directionalLight);

    // Inventory setup
    const inventoryContainer = document.getElementById('inventory');
    const blockTypes = [
      { color: 0x228B22, name: "grass" },
      { color: 0x8B4513, name: "dirt" },
      { color: 0xFFFFFF, name: "snow" },
      { color: 0xFF0000, name: "delete" },
      { color: 0x8B0000, name: "wood" },
      { color: 0xFFFF00, name: "stone" },
      { color: 0x0000FF, name: "water" },
      { color: 0xA52A2A, name: "sand" },
    ];
    let selectedBlockType = blockTypes[0];

    blockTypes.forEach((block, index) => {
      const item = document.createElement('div');
      item.className = 'inventory-item';
      item.style.backgroundColor = `#${block.color.toString(16)}`;
      item.onclick = () => selectBlock(index);
      inventoryContainer.appendChild(item);
    });

    function selectBlock(index) {
      selectedBlockType = blockTypes[index];
    }

    // Joystick setup
    const joystick = document.getElementById('joystick-container');
    let joystickOffset = { x: 0, y: 0 };
    let isDragging = false;

    joystick.addEventListener('pointerdown', () => isDragging = true);
    window.addEventListener('pointerup', () => { isDragging = false; joystickOffset = { x: 0, y: 0 }; });
    window.addEventListener('pointermove', (event) => {
      if (!isDragging) return;
      joystickOffset = { x: event.clientX - 50, y: event.clientY - 50 };
    });

    // Jump button
    const jumpButton = document.getElementById('jump-button');
    let jumpVelocity = 0;
    let isOnGround = false;
    jumpButton.addEventListener('pointerdown', () => {
      if (isOnGround) jumpVelocity = 0.5;
      isOnGround = false;
    });

    // Camera rotation (mimicking Minecraft Pocket Edition)
    let cameraRotation = { x: 0, y: 0 };
    const rotationSpeed = 0.002;
    window.addEventListener('pointermove', (event) => {
      if (event.buttons === 1) {
        cameraRotation.x -= event.movementY * rotationSpeed;
        cameraRotation.y -= event.movementX * rotationSpeed;
        camera.rotation.set(cameraRotation.x, cameraRotation.y, 0);
      }
    });

    // Player movement
    function updateMovement() {
      const speed = 0.1;
      camera.position.x += joystickOffset.x * speed * 0.01;
      camera.position.z += joystickOffset.y * speed * 0.01;

      jumpVelocity += -0.02;  // Gravity
      camera.position.y += jumpVelocity;
      if (camera.position.y < 5) { camera.position.y = 5; jumpVelocity = 0; isOnGround = true; }
    }

    // Advanced terrain generation with multiple biomes and Perlin Noise
    const terrainWidth = 256;
    const terrainHeight = 256;
    const terrainScale = 0.1;
    const chunkHeight = 10;
    const loadedChunks = new Set();

    function generatePerlinNoise(width, height, scale = 1) {
      const noise = [];
      for (let x = 0; x < width; x++) {
        noise[x] = [];
        for (let y = 0; y < height; y++) {
          noise[x][y] = (Math.sin(x * scale) + Math.cos(y * scale)) * Math.random();
        }
      }
      return noise;
    }

    function generateTerrain(xStart, zStart) {
      const chunkKey = `${xStart},${zStart}`;
      if (loadedChunks.has(chunkKey)) return;

      const noise = generatePerlinNoise(terrainWidth, terrainHeight, terrainScale);

      for (let x = 0; x < terrainWidth; x++) {
        for (let z = 0; z < terrainHeight; z++) {
          const height = Math.floor(noise[x][z] * chunkHeight);
          for (let y = 0; y <= height; y++) {
            const blockColor = getBlockColorBasedOnHeight(y, height);
            createBlock(x + xStart, y, z + zStart, blockColor);
          }

          // Add trees in the biome
          if (height > 5 && Math.random() < 0.05) {
            createTree(x + xStart, height + 1, z + zStart);
          }

          // Add lakes or water
          if (height < 3 && Math.random() < 0.03) {
            createWater(x + xStart, height, z + zStart);
          }
        }
      }

      loadedChunks.add(chunkKey);
    }

    function getBlockColorBasedOnHeight(y, height) {
      if (y === height) return 0x228B22; // Grass on top
      if (y < height - 2) return 0x8B4513; // Dirt below
      return 0x8B0000; // Stone at the bottom
    }

    // Create a tree (simple model)
    function createTree(x, y, z) {
      const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.5, 3);
      const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
      const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
      trunk.position.set(x, y, z);
      scene.add(trunk);

      const foliageGeometry = new THREE.SphereGeometry(1, 8, 8);
      const foliageMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
      const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
      foliage.position.set(x, y + 2, z);
      scene.add(foliage);
    }

    // Create water
    function createWater(x, y, z) {
      const waterGeometry = new THREE.BoxGeometry(1, 0.2, 1);
      const waterMaterial = new THREE.MeshLambertMaterial({ color: 0x1E90FF, opacity: 0.5, transparent: true });
      const water = new THREE.Mesh(waterGeometry, waterMaterial);
      water.position.set(x, y, z);
      scene.add(water);
    }

    // Main animation loop
    function animate() {
      updateMovement();
      generateTerrain(Math.floor(camera.position.x / terrainWidth) * terrainWidth, Math.floor(camera.position.z / terrainHeight) * terrainHeight);
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    // Initialize camera position and start animation
    camera.position.set(0, 5, 10);
    camera.lookAt(0, 5, 0);
    animate();
  </script>
</body>
</html>
